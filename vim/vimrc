" Create backup folder for persistent undo
silent !mkdir -p ~/.config/nvim/backups

" Options
set nocompatible
set undodir=~/.config/nvim/backups
set undofile
"set mouse=a
set encoding=utf-8
set background=light
set termguicolors
set hidden
set cursorline
set modelines=0
set nobackup
set nowritebackup
set noswapfile
set wrap
set history=9999
set undolevels=9999
set number
set numberwidth=5
set autoindent
set copyindent
set smartindent
set ruler
set incsearch
set hlsearch
set autoread
set visualbell
set noerrorbells
set showmatch
set showcmd
set tabstop=2
set softtabstop=2
set shiftwidth=2
set shiftround
set backspace=indent,eol,start
set expandtab
set nosmarttab
"set textwidth=80
set colorcolumn=80
set ignorecase
set smartcase
set splitright
set wildignore=*.swp,*.bak,*.pyc
set pastetoggle=<F2>
set title
set list
set listchars=tab:>.,trail:.,extends:#,nbsp:.
set scrolloff=3
set sidescrolloff=5
set sidescroll=5
set nospell
set foldmethod=indent
set foldnestmax=10
set nofoldenable
set foldlevel=2
set clipboard+=unnamedplus
set signcolumn=yes
set statusline=%<\ %n:%f\ %m%r
set statusline+=%#warningmsg#%{fugitive#statusline()}%*
set statusline+=%=line:\ %l\/%L,\ col:\ %c%V\ (%P)\ 0x%B

" Vundle
filetype off

set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()

set rtp+=~/.fzf

Plugin 'gmarik/Vundle.vim'
Plugin 'tpope/vim-sensible'
Plugin 'tpope/vim-surround'
Plugin 'tpope/vim-fugitive'
Plugin 'kshenoy/vim-signature'
Plugin 'airblade/vim-gitgutter'
Plugin 'ctrlpvim/ctrlp.vim'
Plugin 'ivalkeen/vim-ctrlp-tjump'
Plugin 'mileszs/ack.vim'
Plugin 'moll/vim-bbye'
Plugin 'vim-scripts/verilog_systemverilog_fix'
Plugin 'nelstrom/vim-visual-star-search'
Plugin 'valloric/youcompleteme'
Plugin 'rdnetto/YCM-Generator'
Plugin 'easymotion/vim-easymotion'
Plugin 'scrooloose/nerdtree'
Plugin 'Xuyuanp/nerdtree-git-plugin'
Plugin 'mtth/scratch.vim'
Plugin 'scrooloose/nerdcommenter'
Plugin 'vim-airline/vim-airline'
Plugin 'vim-airline/vim-airline-themes'
Plugin 'godlygeek/tabular'
Plugin 'plasticboy/vim-markdown'
Plugin 'majutsushi/tagbar'
Plugin 'elzr/vim-json'
Plugin 'junegunn/gv.vim'
Plugin 'junegunn/fzf.vim'
Plugin 'flazz/vim-colorschemes'
"Plugin 'hzchirs/vim-material'
"Plugin 'cocopon/iceberg.vim'

call vundle#end()

filetype plugin indent on

" Colors
syntax on
colorscheme Tomorrow

" Trim whitespace
autocmd BufWritePre * :%s/\s\+$//e

" Read external file changes
autocmd BufEnter,FocusGained,CursorHold,CursorHoldI * :checktime

" Close if quickfix is the last window
autocmd BufEnter * if (winnr('$') == 1 && &buftype == 'quickfix') | q | endif

" Close if NERDTree is the last window
autocmd BufEnter * if (winnr('$') == 1 && exists('b:NERDTree') && b:NERDTree.isTabTree()) | q | endif

" Use tabs with Makefiles
autocmd FileType make setlocal noexpandtab

" Don't use Tagbar with VHDL
autocmd FileType vhdl let b:tagbar_ignore = 1

" Highlight todos
"call matchadd('Todo', '\s\+$')
call matchadd('Todo', 'TODO')
call matchadd('Todo', 'TODO:')
call matchadd('Todo', 'FIXME')
call matchadd('Todo', 'FIXME:')
call matchadd('Todo', 'DEBUG')
call matchadd('Todo', 'DEBUG:')
call matchadd('Todo', 'NOTE')
call matchadd('Todo', 'NOTE:')
call matchadd('Todo', 'NOTES')
call matchadd('Todo', 'NOTES:')

" Define new leader key
let mapleader = ','

" File explorer style
let g:netrw_liststyle = 1

" Airline
let g:airline_theme = 'tomorrow'
let g:airline_powerline_fonts = 1
let g:airline_left_sep = ''
let g:airline_right_sep = ''
let g:airline#extensions#tabline#enabled = 1
let g:airline#extensions#tabline#left_sep = ''
let g:airline#extensions#tabline#left_alt_sep = '|'
let g:airline#extensions#tabline#right_sep = ''
let g:airline#extensions#tabline#right_alt_sep = '|'
"let g:airline#extensions#tabline#buffer_idx_mode = 1

" Use Rg for Ctrl-P
if executable('rg')
  let g:ctrlp_user_command = 'rg --files %s'
  let g:ctrlp_use_caching = 0
  let g:ctrlp_working_path_mode = 'ra'
  let g:ctrlp_switch_buffer = 'et'
endif

" Use better Ack
"let g:ackprg = 'ag --nogroup --nocolor --column'
let g:ackprg = 'rg --vimgrep --no-heading'
cnoreabbrev ag Ack
cnoreabbrev aG Ack
cnoreabbrev Ag Ack
cnoreabbrev AG Ack
cnoreabbrev rg Ack
cnoreabbrev rG Ack
cnoreabbrev Rg Ack
cnoreabbrev RG Ack

let g:NERDTreeWinSize = 40
let g:tagbar_width = 40

let g:vim_json_syntax_conceal = 0
let g:ycm_glocal_ycm_extra_conf = '~/.ycm_extra_conf.py'

" EasyMotion highlighting
hi link EasyMotionTarget2First Number
hi link EasyMotionTarget2Second Number

" Use ii instead of ESC
imap ii <Esc>

" Increment and decrement numbers
nnoremap <A-a> <C-a>
nnoremap <A-x> <C-x>

" Buffer navigation
nnoremap <C-L> :bnext<CR>
nnoremap <C-H> :bprevious<CR>

" Buffer resizing
nnoremap <C-W><C-K> :exe "resize +5"<CR>
nnoremap <C-W><C-J> :exe "resize -5"<CR>
nnoremap <C-W><C-L> :exe "vertical resize +5"<CR>
nnoremap <C-W><C-H> :exe "vertical resize -5"<CR>

" Close buffer without closing window
nnoremap <C-X> :Bdelete<CR>

" Go to last buffer
nnoremap <tab> :b#<CR>

" Use ctags with Ctrl-P
nnoremap <leader>. :CtrlPTag<CR>

" Use tjump with Ctrl-P
nnoremap <C-]> :CtrlPtjump<CR>
vnoremap <C-]> :CtrlPtjumpVisual<CR>

" Use current search for Ack
nnoremap <leader>8 :AckFromSearch!<CR>

" Toggle NERD Tree
nnoremap <C-N> :NERDTreeToggle<CR>
nnoremap <C-M-N> :NERDTreeFind<CR>

" Toggle TagBar
nnoremap <C-M-M> :TagbarToggle<CR>

" Remove search result highlighting
nnoremap <C-C> :noh<CR>

" Exit terminal mode
if has('nvim')
  tnoremap <leader>e <C-\><C-n>
endif
